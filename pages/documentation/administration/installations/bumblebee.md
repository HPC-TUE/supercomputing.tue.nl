# SCM Bumblebee

## License agreement

The software is developed by SCM (formerly by Simbeyond), in partnership with
group M2N at the physics department.  The group has not indicated what the
licensing terms are, so currently the license file is only made available to
members of that group.

## How does Bumblebee work?

Users submit jobs through a web portal hosted by SCM.  The web portal makes an SSH connection to a server, authenticates with pubkey, and then runs various scripts to start Bumblebee.  The private key is generated by the web portal; users add the corresponding public key to their local `.ssh/authorized_keys`.

Bumblebee is intended to be run on cloud VMs.  In that case the web portal can directly connect to the VMs as described above.

In our case, the cluster is not reachable through SSH from the internet, so the above doesn't work.  Instead, users connect from the login node to the web portal server with SSH, with remote port forwarding of port e.g. 1234 to port 22 (login node SSH server).  In the web portal, they configure server hostname `localhost:1234`.  When they submit a job, the portal will connect to `localhost:1234`, which is forwarded through the SSH tunnel to our login node's SSH server, which then authenticates the portal using pubkey.  The portal then uses locally installed scripts, to submit and monitor a job using `sbatch` etc.

## v3.37.13 installation

Requirements:

- `bumblebee` executable
- `env.sh` script
- various scripts

Prepare release tarball:

```bash
mkdir bumblebee
mkdir bumblebee/bin
mkdir bumblebee/scripts
mv $BUMBLEBEE_ENV_SCRIPT bumblebee
mv $BUMBLEBEE_EXE        bumblebee/bin
mv $BUMBLEBEE_SCRIPTS    bumblebee/scripts
chmod +x bumblebee/env.sh
chmod +x bumblebee/bin/bumblebee
tar czf bumblebee-$VERSION.tgz bumblebee

# Tree now is:
#
# bumblebee/env.sh
# bumblebee/bin/bumblebee
# bumblebee/scripts/bumblebee-stop
# bumblebee/scripts/bumblebee-submit
# bumblebee/scripts/bumblebee-sweep
# bumblebee/scripts/submit
# bumblebee/scripts/generators/...
# bumblebee/scripts/postprocess/...
# bumblebee/scripts/preprocess/...
```

Software installation:

- An EasyConfig is provided on GitLab.
- Steps:
  ```
  mv bumblebee.tgz ...  # Move tarball to somewhere where EB can find it.
  eb Bumblebee-3.37.13
  ```

## License installation

License installation:

```
mkdir /sw/rl8/zen/lic/Bumblebee
cd    /sw/rl8/zen/lic/Bumblebee
cp    license-20240614.txt .            # License file creation date in file name
ln -s license-20240614.txt license.txt
# Now: chown/chmod cf. license agreement above.
```
